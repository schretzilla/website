var quizDetail=angular.module("quizDetail",[]);quizDetail.config(function(e){e.startSymbol("{[{"),e.endSymbol("}]}")}),quizDetail.config(["$httpProvider",function(e){e.defaults.xsrfCookieName="csrftoken",e.defaults.xsrfHeaderName="X-CSRFToken"}]),quizDetail.controller("QuizDetailCtrl",function(e,t,n,i){e.addQuestion=function(){question=questionObj(e.quizId,e.questionText),postQuestion(question).then(function(t){newQuestion=t.data,e.questions.push(newQuestion),angular.forEach(e.choiceList,function(e,t){postNewChoice(newQuestion,e)}),e.questionText="",e.choiceList=[nullChoice()],e.selectedAnswer=""},function(e){alert("Unable to post question"+e.message)})},nullChoice=function(){return choiceObj(1,"",0)},postNewChoice=function(t,n){""!=n.choice_text&&(n.question=t.id,postChoice(n).then(function(i){newChoice=i.data,t.choices.push(newChoice),1==n.correct&&e.setAnswer(t,newChoice.id)},function(e){alert("Unable to post choice "+e.message)}))},e.addChoice=function(e,t){choice=choiceObj(0,t,e.id),postNewChoice(e,choice),e.newChoice=""},e.removeChoice=function(e,t,n){deleteChoice(t).then(function(t){n.splice(e,1)},function(e){alert("Unable to delete choice "+e.message)})},e.persistCurText=function(t){e.curText=t},e.updateChoice=function(t){statusSaving(),""!=t.choice_text&&t.choice_text!=e.curText&&updateChoice(t).then(function(n){e.curText=t.choice_text,statusSaved()})},e.updateQuestion=function(t){statusSaving(),""!=t.question_text&&t.question_text!=e.curText&&updateQuestion(t).then(function(n){e.curText=t.question_text,statusSaved()},function(e){alert("Unable to update question "+e.message)})},statusSaving=function(){e.formStatus="Saving",e.startFade=!1,e.hideStatus=!1},statusSaved=function(){e.formStatus="Saved!",e.startFade=!0,t(function(){e.hideStatus=!0},3e3)},e.removeQuestion=function(t){question=e.questions[t],deleteQuestion(question.id).then(function(n){e.questions.splice(t,1)},function(e){alert("Unable to delete question "+e.message)})},e.loadQuestions=function(){getQuestions(e.quizId).then(function(t){e.questions=t.data},function(e){alert("Unable to load questions "+e.message)})},loadQuiz=function(t){getQuiz(t).then(function(t){e.curQuiz=t.data},function(e){alert("Unable to load quiz "+e.message)})},getQuiz=function(e){return i.get("/dynoquiz/api/quiz/"+e+"/")},postQuestion=function(e){return i.post("/dynoquiz/api/quiz/"+e.quiz+"/question/",e)},postChoice=function(e){return i.post("/dynoquiz/api/question/"+e.question+"/choice/",e)},updateChoice=function(e){return i.put("/dynoquiz/api/question/"+e.question+"/choice/"+e.id+"/",e)},deleteChoice=function(e){return i["delete"]("/dynoquiz/api/question/"+e.question+"/choice/"+e.id+"/")},getQuestions=function(e){return i.get("/dynoquiz/api/quiz/"+e+"/question")},deleteQuestion=function(t){return i["delete"]("/dynoquiz/api/quiz/"+e.quizId+"/question/"+t+"/")},updateQuestion=function(e){return i.put("/dynoquiz/api/quiz/"+e.quiz+"/question/"+e.id+"/",e)},choiceObj=function(e,t,n){return{id:e,choice_text:t,question:n,"new":!0,votes:0,correct:!1}},questionObj=function(e,t){return{quiz:e,question_text:t,choices:[],date_created:new Date}},questionObj=function(e,t,n){return{quiz:e,question_text:t,choices:[],answer:n,date_created:new Date}},e.setAnswer=function(e,t){statusSaving(),e.answer=t,updateQuestion(e).then(function(e){statusSaved()},function(e){alert("Unable to save new answer "+e)})},e.updateQuestionText=function(t){alert("changed from "+e.curText)},e.cancelQuestion=function(){e.choiceList=[nullChoice()],e.questionText=""},e.loadPage=function(t){e.quizId=t,e.loadQuestions(),e.choiceList=[nullChoice()],loadQuiz(t)},e.questionValid=function(){return e.choiceList.length>1&&null!=e.questionText},e.dynamicList=function(e,t){listLength=e.length,attribute=e[listLength-1][t],""!=attribute?(newObject={id:e.length,"new":!0},newObject[t]="",e.push(newObject)):""==e[listLength-2][t]&&e.pop()}});